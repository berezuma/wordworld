<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word World - Spelling Adventure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        .level-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .level-card:hover:not(.locked) {
            transform: translateY(-5px) scale(1.02);
        }
        .locked {
            filter: grayscale(1);
            opacity: 0.7;
            cursor: not-allowed;
        }
        .bounce-in {
            animation: bounceIn 0.5s ease-out;
        }
        .score-pop {
            animation: scorePop 0.4s ease-out;
        }
        @keyframes bounceIn {
            0% { transform: scale(0.8); opacity: 0; }
            70% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes scorePop {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); color: #eab308; }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="app" class="max-w-4xl mx-auto">
        <!-- HEADER -->
        <header class="text-center mb-8 relative">
            <h1 class="text-5xl font-bold text-blue-600 drop-shadow-sm mb-2">Word World</h1>
            <p class="text-blue-400 font-semibold tracking-wide uppercase text-sm">Spelling Adventure</p>
            
            <!-- Global Score Display -->
            <div class="absolute top-0 right-0 bg-white px-4 py-2 rounded-2xl shadow-md border-2 border-yellow-400">
                <span class="text-gray-500 text-xs font-bold block uppercase">Points</span>
                <span id="global-score-display" class="text-2xl font-black text-yellow-600">0</span>
            </div>
        </header>

        <!-- MODE SELECTION -->
        <div id="mode-selection" class="flex flex-col md:flex-row gap-6 justify-center items-stretch mt-12 bounce-in">
            <button onclick="setPlayMode('adventure')" class="flex-1 bg-white p-8 rounded-3xl shadow-xl hover:shadow-2xl transition-all border-4 border-transparent hover:border-blue-500 group">
                <div class="text-6xl mb-4 group-hover:scale-110 transition-transform">üó∫Ô∏è</div>
                <h3 class="text-2xl font-bold text-blue-600 mb-2">Adventure Mode</h3>
                <p class="text-gray-500">Step by step. Unlock words with points!</p>
            </button>
            <button onclick="setPlayMode('free')" class="flex-1 bg-white p-8 rounded-3xl shadow-xl hover:shadow-2xl transition-all border-4 border-transparent hover:border-green-500 group">
                <div class="text-6xl mb-4 group-hover:scale-110 transition-transform">üöÄ</div>
                <h3 class="text-2xl font-bold text-green-600 mb-2">Free Ride</h3>
                <p class="text-gray-500">No limits. Practice any level you want!</p>
            </button>
        </div>

        <!-- DASHBOARD CONTAINER -->
        <div id="dashboard-container" class="hidden space-y-6">
            <!-- Reset Mode Button -->
            <div class="flex justify-start">
                <button onclick="resetToModeSelection()" class="bg-white/50 hover:bg-white text-blue-600 px-4 py-2 rounded-xl text-sm font-bold shadow-sm transition-all flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 15l-3-3m0 0l3-3m-3 3h8M3 12a9 9 0 1118 0 9 9 0 01-18 0z" />
                    </svg>
                    Switch Game Mode
                </button>
            </div>

            <!-- DASHBOARD GRID -->
            <div id="dashboard" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Levels generated dynamically -->
            </div>
        </div>

        <!-- GAME SCREEN -->
        <div id="game-screen" class="hidden bounce-in">
            <div class="bg-white rounded-3xl shadow-2xl p-6 md:p-10 relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-2 bg-gray-100">
                    <div id="progress-bar" class="h-full bg-blue-500 transition-all duration-500 w-0"></div>
                </div>

                <div class="flex justify-between items-center mb-10 mt-4">
                    <button onclick="showDashboard()" class="text-gray-400 hover:text-red-400 transition-colors flex items-center gap-2 font-bold">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                        </svg> Back
                    </button>
                    <div id="level-title" class="bg-blue-100 text-blue-700 px-4 py-1 rounded-full text-sm font-bold uppercase tracking-wider">Level 1</div>
                    <div id="counter" class="text-blue-500 font-bold">1 / 10</div>
                </div>

                <div class="flex flex-col items-center py-10">
                    <button onclick="playCurrentAudio()" class="group relative bg-blue-500 hover:bg-blue-600 p-10 rounded-full shadow-lg transition-all active:scale-95 mb-8">
                        <div class="absolute inset-0 rounded-full animate-ping bg-blue-400 opacity-20 group-hover:hidden"></div>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 18v-6a9 9 0 0118 0v6M3 18a2 2 0 01-2-2v-3a2 2 0 012-2h3a2 2 0 012 2v3a2 2 0 01-2 2H3zm18 0a2 2 0 002-2v-3a2 2 0 00-2-2h-3a2 2 0 00-2 2v3a2 2 0 002 2h3z" />
                        </svg>
                    </button>

                    <div id="practice-area" class="text-center">
                        <h2 id="word-display" class="text-7xl font-bold text-blue-800 mb-8 tracking-tighter uppercase">---</h2>
                        <button onclick="nextWord()" class="bg-green-500 hover:bg-green-600 text-white px-10 py-4 rounded-2xl font-bold text-xl shadow-lg transition-all">Next Word</button>
                    </div>

                    <div id="test-area" class="hidden w-full max-w-md text-center">
                        <input type="text" id="answer-input" autocomplete="off" 
                            class="w-full text-4xl text-center p-4 border-b-8 border-blue-200 focus:border-blue-500 focus:outline-none uppercase bg-transparent text-blue-900 placeholder-blue-100 transition-colors mb-6" 
                            placeholder="Type here...">
                        <button id="check-btn" onclick="checkAnswer()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-5 rounded-2xl text-2xl shadow-xl transition-all active:translate-y-1">
                            Check!
                        </button>
                    </div>

                    <div id="feedback" class="mt-8 h-10 text-2xl font-bold flex items-center gap-2"></div>
                </div>
            </div>
        </div>

        <!-- RESULTS SCREEN -->
        <div id="result-screen" class="hidden text-center bounce-in bg-white rounded-3xl shadow-2xl p-10">
            <div class="text-9xl mb-6">üéâ</div>
            <h2 class="text-4xl font-bold text-blue-600 mb-2">Level Complete!</h2>
            <p id="result-text" class="text-gray-500 text-xl mb-8">You have learned all the words in this level.</p>
            <div class="flex flex-col gap-4">
                <button onclick="showDashboard()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 rounded-2xl text-xl shadow-lg">Back to World Map</button>
            </div>
        </div>
    </div>

    <audio id="audio-player"></audio>

    <script>
        const levels = [
            { id: 1, title: "Easy Start", color: "bg-green-400", words: ["gift", "list", "sun", "lamp", "big", "let", "but", "stop", "gap", "club", "bad", "belt"] },
            { id: 2, title: "AI/OA Digraphs", color: "bg-blue-400", words: ["rain", "jam", "jacket", "brain", "boat", "road", "sail", "soap"] },
            { id: 3, title: "Long Vowels 1", color: "bg-yellow-400", words: ["jump", "train", "coat", "jog", "die", "tree", "pie", "storm", "bee", "lie"] },
            { id: 4, title: "Long Vowels 2", color: "bg-orange-400", words: ["born", "sleep", "horn", "fork", "deep", "tie", "zap", "week"] },
            { id: 5, title: "Short Words", color: "bg-red-400", words: ["van", "good", "web", "zoo", "wind", "look", "strong", "vet", "long", "buzz"] },
            { id: 6, title: "Tricky Words 1", color: "bg-purple-400", words: ["are", "all", "you", "your", "come", "some", "said"] },
            { id: 7, title: "Here and There", color: "bg-indigo-400", words: ["here", "there", "they", "go", "no", "so", "my", "one", "by", "only", "old", "like"] },
            { id: 8, title: "Questions", color: "bg-pink-400", words: ["have", "live", "give", "little", "down", "what", "when", "why", "where", "who", "which"] },
            { id: 9, title: "More and Before", color: "bg-teal-400", words: ["any", "many", "more", "before", "other", "were", "because", "want", "saw", "put"] },
            { id: 10, title: "Grand Finale", color: "bg-gray-800", words: ["could", "should", "would", "right", "two", "four", "goes", "does", "made", "their"] }
        ];

        let currentPlayMode = null; 
        let currentLevel = null;
        let currentIndex = 0;
        let currentMode = ''; 
        let unlockedLevels = parseInt(localStorage.getItem('unlockedLevels')) || 1;
        let globalScore = parseInt(localStorage.getItem('globalScore')) || 0;
        const audioPath = './audios/';

        function updateGlobalScoreDisplay() {
            const display = document.getElementById('global-score-display');
            display.innerText = globalScore;
            display.classList.remove('score-pop');
            void display.offsetWidth; 
            display.classList.add('score-pop');
        }

        function addPoints(points) {
            globalScore += points;
            localStorage.setItem('globalScore', globalScore);
            updateGlobalScoreDisplay();
        }

        function setPlayMode(mode) {
            currentPlayMode = mode;
            document.getElementById('mode-selection').classList.add('hidden');
            document.getElementById('dashboard-container').classList.remove('hidden');
            updateGlobalScoreDisplay();
            initDashboard();
        }

        function resetToModeSelection() {
            currentPlayMode = null;
            document.getElementById('mode-selection').classList.remove('hidden');
            document.getElementById('dashboard-container').classList.add('hidden');
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
        }

        function initDashboard() {
            const container = document.getElementById('dashboard');
            container.innerHTML = '';
            
            levels.forEach(level => {
                const isLocked = currentPlayMode === 'adventure' && level.id > unlockedLevels;
                const card = document.createElement('div');
                card.className = `level-card p-6 rounded-3xl shadow-lg cursor-pointer flex flex-col items-center justify-between min-h-[200px] text-white ${level.color} ${isLocked ? 'locked' : ''}`;
                
                card.innerHTML = `
                    <div class="text-sm font-bold opacity-80 uppercase tracking-widest">Level ${level.id}</div>
                    <div class="text-2xl font-bold text-center">${level.title}</div>
                    ${isLocked ? `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                        </svg>
                    ` : `
                        <div class="flex gap-2 w-full mt-4">
                            <button onclick="startGame(${level.id}, 'practice')" class="flex-1 bg-white/20 hover:bg-white/40 py-2 rounded-xl text-sm font-bold transition-colors">Practice</button>
                            <button onclick="startGame(${level.id}, 'test')" class="flex-1 bg-white text-blue-900 py-2 rounded-xl text-sm font-bold shadow-md hover:bg-blue-50 transition-colors">Test</button>
                        </div>
                    `}
                `;
                
                if (!isLocked) {
                    card.onclick = (e) => { if(e.target === card) startGame(level.id, 'practice') };
                }
                container.appendChild(card);
            });
        }

        function startGame(levelId, mode) {
            currentLevel = levels.find(l => l.id === levelId);
            currentMode = mode;
            currentIndex = 0;
            
            document.getElementById('dashboard-container').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            
            document.getElementById('level-title').innerText = `${currentLevel.title}`;
            
            if (mode === 'practice') {
                document.getElementById('practice-area').classList.remove('hidden');
                document.getElementById('test-area').classList.add('hidden');
            } else {
                document.getElementById('practice-area').classList.add('hidden');
                document.getElementById('test-area').classList.remove('hidden');
                document.getElementById('answer-input').focus();
            }
            showWord();
        }

        function showWord() {
            const total = currentLevel.words.length;
            document.getElementById('counter').innerText = `${currentIndex + 1} / ${total}`;
            document.getElementById('progress-bar').style.width = `${((currentIndex) / total) * 100}%`;
            document.getElementById('feedback').innerHTML = '';
            
            if (currentMode === 'practice') {
                document.getElementById('word-display').innerText = currentLevel.words[currentIndex];
            } else {
                document.getElementById('answer-input').value = '';
                document.getElementById('answer-input').focus();
            }
            playCurrentAudio();
        }

        function playCurrentAudio() {
            const player = document.getElementById('audio-player');
            const cleanWord = currentLevel.words[currentIndex].toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            player.src = `${audioPath}${cleanWord}.mp3`;
            player.play().catch(() => showFeedback("‚ö†Ô∏è Audio not found", "text-orange-400"));
        }

        function checkAnswer() {
            const userAnswer = document.getElementById('answer-input').value.trim().toLowerCase();
            const correctAnswer = currentLevel.words[currentIndex].toLowerCase().trim();

            if (userAnswer === correctAnswer) {
                showFeedback("Great! +10 üåü", "text-green-500");
                addPoints(10); 
                setTimeout(nextWord, 1000);
            } else {
                showFeedback("Error! Try again", "text-red-400");
                document.getElementById('answer-input').classList.add('animate-bounce');
                setTimeout(() => document.getElementById('answer-input').classList.remove('animate-bounce'), 500);
            }
        }

        function showFeedback(text, colorClass) {
            const f = document.getElementById('feedback');
            f.innerText = text;
            f.className = `mt-8 h-10 text-2xl font-bold flex items-center gap-2 ${colorClass}`;
        }

        function nextWord() {
            currentIndex++;
            if (currentIndex < currentLevel.words.length) {
                showWord();
            } else {
                completeLevel();
            }
        }

        function completeLevel() {
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            
            if (currentMode === 'test') {
                addPoints(100); 
                if (currentPlayMode === 'adventure' && currentLevel.id === unlockedLevels && unlockedLevels < levels.length) {
                    unlockedLevels++;
                    localStorage.setItem('unlockedLevels', unlockedLevels);
                }
                confetti({ particleCount: 200, spread: 80, origin: { y: 0.6 } });
            }
        }

        function showDashboard() {
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            
            if (!currentPlayMode) {
                document.getElementById('mode-selection').classList.remove('hidden');
                document.getElementById('dashboard-container').classList.add('hidden');
            } else {
                document.getElementById('dashboard-container').classList.remove('hidden');
                initDashboard();
            }
        }

        document.getElementById('answer-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') checkAnswer();
        });

        updateGlobalScoreDisplay();
    </script>
</body>
</html>
